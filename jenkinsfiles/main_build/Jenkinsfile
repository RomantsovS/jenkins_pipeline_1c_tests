pipeline {

    agent {label "dev1c" }

    options { 
        timestamps()
        timeout(time: 1, unit: 'HOURS')
    }
    
    stages {
        stage("A") {
            options {
                timeout(time: 60, unit: "SECONDS")
            }

            steps {
                script {
                    commonMethods = load "./lib/CommonMethods.groovy"
                    
                    Exception caughtException = null

                    catchError(buildResult: 'SUCCESS', stageResult: 'ABORTED') { 
                        try { timeout(time: 15, unit: 'SECONDS') { 
                            echo "Started stage A"
                            sleep(time: 15, unit: "SECONDS")
                        }
                        } catch (org.jenkinsci.plugins.workflow.steps.FlowInterruptedException e) {
                            echo "catched FlowInterruptedException"

                            if (commonMethods.isTimeoutException(excp)) {
                                echo "isTimeoutException = true"
                                commonMethods.throwTimeoutException("${STAGE_NAME}")
                            }
                        } catch (Throwable e) {
                            caughtException = e
                        }
                    }

                    if (caughtException) {
                        error caughtException.message
                    }
                }
            }
        }

        stage("B") {
            steps {
                echo "Started stage B"
            }
        }
    }
}